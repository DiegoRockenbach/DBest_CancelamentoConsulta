## Subqueries in the `FROM` Clause  

In SQL, a **subquery** can appear inside the **`FROM` clause** of an outer query.  
When used this way, the subquery is treated as a **temporary table**.  

This approach is particularly useful for **complex computations**,  such as **aggregations**, where rows are grouped into **meaningful clusters**.  
These grouped results can then be **joined** with other tables   or even with the results of additional subqueries.  


The query below retrieves movies where the **number of cast members**  is **equal** to the **number of crew members**.  

The `FROM` clause consists of two **subqueries** joined together using two condition based on movie_id and row counts.  

```sql
SELECT * FROM  
(SELECT movie_id, count(*) as cont FROM movie_cast GROUP BY movie_id) as agg1  
JOIN  
(SELECT movie_id, count(*) as cont FROM movie_crew GROUP BY movie_id) as agg2  
ON agg1.movie_id = agg2.movie_id AND agg1.cont = agg2.cont;  
```

In **DBest**, the same query can be represented by using two **`GROUP BY`** operators: One for **`movie_cast`**  and One for **`movie_crew`**  
These operators **generate new schemas**, which must be **renamed** (`agg1` and `agg2`) to ensure unique schema names.  SQL also requires the naming of temporary tables, as indicated above.  


<img src="assets/images/subqueries-from-clause.png" alt="Subqueries in the FROM clause" width="750"/>  

The **Nested Loop Join** operator matches tuples from `agg1` and `agg2`,  using **two lookup conditions**:  
  - **Matching `movie_id`**  
  - **Matching row count**
   
The **inner side** of the join is **materialized**,  so that the **grouping computation** occurs **only once**.  


When we say that subqueries in the `FROM` clause are treated as temporary tables,   it does not necessarily mean that these tables are **materialized**.  

In the provided example, **only the inner table is materialized**.   The outer table takes advantage of the fact that **`movie_cast` rows are ordered by `movie_id`**,   allowing the **`GROUP BY`** operator to be executed in a **pipelined fashion**. 
